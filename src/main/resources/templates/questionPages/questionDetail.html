<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ğŸˆFind your Base:)-ë¬¸ì˜ë‚´ìš©</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script th:src="@{/js/axios.min.js}"></script>
    <!--ajax cdn-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--  //ì‹œê°„ì„¤ì •-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <!--  í°íŠ¸-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap"
          rel="stylesheet">
    <style>
        *{
            font-family: 'Jua', sans-serif;
            font-family: 'Nanum Gothic', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .main{
            width: 600px;
            height: 409px;
            left: 411px;
            top: 85px;
            /*ê°€ìš´ë° ì •ë ¬ margin: auto*/
            margin-left: auto;
            margin-right: auto;
        }
        /*.contentContainer {*/
        /*    width: 500px;*/
        /*    height: 500px;*/
        /*    left: 500px;*/
        /*    top: 500px;*/
        /*    !* Rectangle 1 *!*/
        /*}*/

        td {
            width: 200px;
        }

        th {
            width: 100px;
        }

    </style>
</head>
<body style="background-color: white">
<th:block th:replace="commonPages/header :: header"></th:block>
<div>
    <div class="main">
        <div class="d-flex justify-content-center">
            <div class="contentContainer">
                <table class="table">
                    <tr>
                        <th>ì‘ì„±ì</th>
                        <td th:text="${question.questionName}"></td>
                    </tr>
                    <tr>
                        <th>ì œëª©</th>
                        <td th:text="${question.questionTitle}"></td>
                    </tr>

                    <tr>
                        <th>ì‘ì„±ì‹œê°„</th>
                        <td th:text="*{#temporals.format(question.questionCreatedTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                    </tr>
                </table>

                <div>
                    <textarea class="form-control" rows="5" th:text="${question.questionContents}" readonly></textarea>
                </div>
<!--                ê´€ë¦¬ìì¼ë•Œ ë³´ì´ëŠ” ê¸°ëŠ¥-->
                <div th:if="${session.member.userId.toString().equals('admin')}">
                    <input id="replyContents" type="text" value="" name="replyContents" class="form-control" style="display: inline" placeholder="ë‹µë³€ë‚´ìš©">
                    <button type="button" class="btn btn-warning" style="display: inline; margin-top: 10px" onclick="reply()">ë‹µë³€ ì‘ì„±</button>
                    <button type="button" class="btn btn-default" style="float:right ; display: inline; margin-top: 10px" onclick="questionList()">ëª©ë¡</button>
                    <button type="button" class="btn btn-success" style="float:right; display: inline; margin-top: 10px" onclick="questionUpdate()">ìˆ˜ì •</button>
                    <button type="button" class="btn btn-danger" style="float:right; display: inline; margin-top: 10px" onclick="questionDelete()">ì‚­ì œ</button>
                </div>
<!--                ì¼ë°˜ì‚¬ìš©ìì¼ë•Œ ë³´ì´ëŠ” ê¸°ëŠ¥-->
                <div th:unless="${session.member.userId.toString().equals('admin')}">
                    <button type="button" class="btn btn-default" style="float:right; display: inline; margin-top: 10px" onclick="questionList()">ëª©ë¡</button>
                    <button type="button" class="btn btn-success" style="float:right; display: inline; margin-top: 10px" onclick="questionUpdate()">ìˆ˜ì •</button>
                    <button type="button" class="btn btn-pr" style="float:right; display: inline; margin-top: 10px" onclick="questionDelete()">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--ëŒ“ê¸€-->
<div class="container mt-5" id="comment-list">
    <div th:if="${replyList == 'empty'}">
        <p>ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <div th:unless="${replyList == 'empty'}">
        <table class="table">
            <tr>
                <th>ì‘ì„±ì</th>
                <th>ë‚´ìš©</th>
                <th>ì‘ì„±ì‹œê°„</th>
                <th>ì‚­ì œ</th>
            </tr>
            <tr th:each="reply: ${replyList}">
                <td th:text="${reply.replyName}"></td>
                <td th:text="${reply.replyContents}"></td>
                <td th:text="*{#temporals.format(reply.replyDate,'yyyy-MM-dd HH:mm:ss')}"></td>
                <td>
                    <button th:if="${session.member.userId.toString().equals('admin')}" class="btn btn-outline-dark" th:onclick="replyDelete([[${reply}]])">ì‚­ì œ</button>
                </td>
            </tr>
        </table>
    </div>
</div>


</body>
<script th:inline="javascript">
    //ë‹µë³€ ì‚­ì œ
    const replyDelete = (reply) => {
        let id = reply.id;
        let questionId = [[${question.id}]];
        if (confirm("ì •ë§ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?ğŸ˜¢") == true){
            location.href = "/reply/delete?replyId=" + id + "&questionId=" + questionId;
        }else {
            return false;
        }

    }

    //ë¬¸ì˜ê¸€ ì‚­ì œ
    const questionDelete = () => {
        const id = [[${question.id}]];
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?ğŸ˜¢')) {

            location.href = "/question/delete/" + id;
        }

    }


    const questionUpdate = () => {
        const id = [[${question.id}]];
        const questionName = [[${question.questionName}]];
        const memberName = [[${session.member.userId}]];
        const userId = [[${session.member.userId}]];

        if (questionName == memberName || userId == 'admin') {
            location.href = '/question/update/' + id;
        } else {
            alert('ì‘ì„±ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
    }


    const questionList = () => {
        location.href = "/question/list";
    }

    const reply = () => {
        console.log("reply");
        const memberId = [[${session.member.id}]];
        const writer = [[${session.member.userId}]];
        const contents = document.getElementById("replyContents").value;
        let questionId = [[${question.id}]];
        $.ajax({
            type: "post",
            url: "/reply/save",
            data: {
                memberId: memberId,
                questionId: questionId,
                replyName: writer,
                replyContents: contents,
            },
            dataType: "json",
            success: function (replyLIst2) {
                let commentList2 = replyLIst2;
                let output = "<table class='table'>";
                output += "<th>ì‘ì„±ì</th>";
                output += "<th>ë‚´ìš©</th>";
                output += "<th>ì‘ì„±ì‹œê°„</th>";
                for (let i in commentList2) {
                    output += "<tr>";
                    output += "<td>" + commentList2[i].replyName + "</td>";
                    output += "<td>" + commentList2[i].replyContents + "</td>";
                    output += "<td>" + moment(commentList2[i].replyDate).format("YYYY-MM-DD HH:mm:ss") + "</td>";
                    output += "</tr>";
                }
                output += "</table>";

                document.getElementById('comment-list').innerHTML = output;
                document.getElementById('replyContents').value = '';

            },
            error: function () {
                console.log("ì‹¤íŒ¨");
            }
        });
    }


</script>
</html>