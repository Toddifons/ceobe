<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>üéàFind your Base:)-PC</title>
    <!--bootstrap cdn-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!--  Ìè∞Ìä∏-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body style="background-color: white">
<th:block th:replace="commonPages/header :: header"></th:block>
<nav>
    <div class="container" style="position: relative">
        <div class="btn-group" style="top: 0px; left: 20px; position: relative">
            <a th:href="@{/item/category1(page=${page} ,sort='id' , size=${size},search=${search},category=${category})}"
               th:style="${sort.equals('id')} ? 'color: black' " style="color: black">ÏµúÏã†Ïàú</a>
            <a th:href="@{/item/category1(page=${page} ,sort='itemPrice' , size=${size},search=${search},category=${category})}"
               th:style="${sort.equals('itemPrice')} ? 'color: black' " style="color: black">ÎÇÆÏùÄÍ∞ÄÍ≤©Ïàú</a>
            <a th:href="@{/item/category1(page=${page} ,sort='itemSellCount' , size=${size},search=${search},category=${category})}"
               th:style="${sort.equals('itemSellCount')} ? 'color: black' " style="color: black">ÌåêÎß§Ïàú</a>
        </div>

<!--        Ï†ïÎ†¨Î≤ÑÌäº-->
        <div class="btn-group dropdown" style="right:40px ;position:relative ; float: right">
            <button type="button" class="dropdown-toggle active" data-bs-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="true" th:text="${size}+'Í∞úÏî©Î≥¥Í∏∞'" id="dropdown_form">
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li th:class="${size == 1} ? 'dropdown-item active' " class="dropdown-item active"><a
                        th:href="@{/item/small(page=1, size=5 , sort=${sort})}" class="dropdown-item">5Í∞úÏî©</a></li>
                <li th:class="${size == 2} ? 'dropdown-item active' " class="dropdown-item active"><a
                        th:href="@{/item/small(page=1, size=10 , sort=${sort})}" class="dropdown-item">10Í∞úÏî©</a></li>
                <li th:class="${size == 3} ? 'dropdown-item active' " class="dropdown-item active"><a
                        th:href="@{/item/small(page=1, size=20, sort=${sort})}" class="dropdown-item">20Í∞úÏî©</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container" id="productSaveForm">
    <div th:if="${session.member != null and session.member.role == 'admin'}">
        <a href="/item/save">ÏÉÅÌíàÎì±Î°ù</a>
    </div>
</div>

<div class="container">
    <table class="table table-striped table-hover text-center mt-5" th:if="${message} != 'null'">
        <div style="text-align: left">
            <div th:each="item: ${itemList}">
                <div class="item  col-xs-3 col-md-4" style="width: 280px ; height: 350px">
                    <div class="thumbnail" style="border: none">
                        <div th:if="${item.fileAttachedItem == 1}">
                            <img th:src="@{|/upload/${item.storedFileNameItem.get(0)}}" alt="" width="250" height="200">
                        </div>
                        <div th:if="${item.fileAttachedItem == 0}">
                            Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå
                        </div>
                        <p class="read"><a style=" font-weight: bold ; color: #222;"
                                           th:href="@{/item/(itemId=${item.id})}"
                                           th:text="${item.itemName}"></a></p>

                        <div class="caption" style="padding-left: 0px; padding-top: 0px">
                            <div class="row">
                                <div class="col-xs-12 col-md-8" style="text-align: left">
                                    <div th:if="${item.itemCount == 0}">
                                        <p style="color: red; font-weight: bold; float: left; padding-left: 30px;">ÌíàÏ†à</p>
                                        <div style="font-weight: bold">
                                            <p style=" text-align: left" th:text="${#numbers.formatInteger(item.itemPrice,0,'COMMA')}"></p>
                                        </div>
                                    </div>
                                    <div th:unless="${item.itemCount == 0}">
                                        <div style="font-weight: bold">
                                            <p th:text="${#numbers.formatInteger(item.itemPrice,0,'COMMA')}+'Ïõê'"></p>
                                        </div>
                                    </div>
                                    <div th:if="${session.member != null and session.member.role == 'admin'}">
                                        <button th:onclick="updateReq([[${item}]])" class="btn btn-outline-secondary btn-sm">ÏÉÅÌíà ÏàòÏ†ï</button>
                                        <button th:onclick="deleteReq([[${item}]])" class="btn btn-outline-secondary btn-sm">ÏÉÅÌíà ÏÇ≠Ï†ú</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            </div>
        </div>
    </table>

    <div class="container" style="position:relative ; text-align: center">
        <div class="search" style="position: relative ; bottom: 0px ; left: 300px">
            <!-- Î∂ÄÎìúÏä§Ìä∏Îû© Í≤ÄÏÉâÏ∞Ω -->
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <select class="form-control" id="category">
                        <option value="itemName">ÏÉÅÌíàÏù¥Î¶Ñ</option>
                    </select>
                    <input type="text" class="form-control" placeholder="Search" id="searchQ" th:value="${search}"
                           name="search">
                    <input type="button" value="Í≤ÄÏÉâ" class="form-control" onclick="searchList()">
                </div>
            </form>
        </div>
        <div style="position: relative ; bottom: -40px;  right: 260px">
            <ul th:if="${message} != 'null'" class="pagination justify-content-center">
                <!-- startPage ~ endPage ÍπåÏßÄ Ïà´ÏûêÎ•º ÎßåÎì§Ïñ¥Ï£ºÎäî Ïó≠Ìï† -->
                <li th:each="page: ${#numbers.sequence(startPage, endPage)}"
                    th:class="${page == itemList.number + 1} ? 'page-item active'" class="page-item">
                    <a class="page-link" th:text="${page}"
                       th:href="@{/item/main(page=${page},sort=${sort},size=${size},search=${search},category=${category})}"></a>
                </li>
            </ul>
        </div>
    </div>



</div>
<div id="sidebar" class="sidebar-form" style="position: absolute; top: 200px ; right: 50px">
    <ul>
        <li align="center">
            ÏµúÍ∑ºÎ≥∏ÏÉÅÌíà
            <br>Ôø£Ôø£Ôø£Ôø£Ôø£
        </li>

        <li><img id="recentItemImg0" src="/img/today-top.png" alt="" width="50" height="50" ></li>
        <li><a id="recentItemId0" href="#"></a></li>

        <li><img id="recentItemImg1" src="/img/today-top.png" alt="" width="50" height="50" ></li>
        <li><a id="recentItemId1" href="#"></a></li>

        <li><img id="recentItemImg2" src="/img/today-top.png" alt="" width="50" height="50" ></li>
        <li><a id="recentItemId2" href="#"></a></li>
    </ul>
</div>

<script th:inline="javascript">
    //ÏÉÅÌíà Í≤ÄÏÉâ
    const searchList = () => {
        const sort = [[${sort}]];
        const size = [[${size}]];
        const Type = document.getElementById("category")
        const category = Type.options[Type.selectedIndex].value;
        const search = document.getElementById("searchQ").value;
        location.href = "/item/main?category=" + category + "&search=" + search + "&sort=" + sort + "&size=" + size;
    }


    //ÏÉÅÌíà ÏàòÏ†ï
    const updateReq = (updateFn) => {
        console.log(updateFn);
        const id = updateFn.id;
        location.href = "/item/update/" + id;
    }
    //ÏÉÅÌíà ÏÇ≠Ï†ú
    const deleteReq = (deleteFn) => {
        console.log(deleteFn);
        const id = deleteFn.id;
        location.href = "/item/delete/" + id;
    }

    //ÏµúÍ∑ºÎ≥∏ÏÉÅÌíà

    const recentItems = JSON.parse(localStorage.getItem("recentItems")) || [];
    const currentTime = Date.now();
    const filteredRecentItems = recentItems.filter(item => currentTime - item.timestamp < 10000);
    localStorage.setItem("recentItems", JSON.stringify(filteredRecentItems));
    filteredRecentItems.forEach((item) => {
        if (item != null) {
            for (let i = 0; i < filteredRecentItems.length; i++) {
                if (filteredRecentItems[i] != null) {
                    document.getElementById("recentItemId"+i).href = "/item/?itemId=" + filteredRecentItems[i].itemId;
                    document.getElementById("recentItemImg"+i).src = "/upload/"+filteredRecentItems[i].itemImage
                    document.getElementById("recentItemId"+i).innerHTML = filteredRecentItems[i].itemName;
                }
            }
        }
    });




</script>
</body>
</html>