<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ğŸˆFind your Base:)-Join!</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  <!--ajax cdn-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!--  í°íŠ¸-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/save.css}" type="text/css">
</head>
<body style="background-color: white">
<th:block th:replace="commonPages/header :: header"></th:block>

<div class="main">
  <header id="header">
    <h1 class="tit mt-5">íšŒì›ê°€ì…ğŸ™‡</h1>
  </header>
  <form name="join" action="/member/signup" method="post">
    <fieldset>
      <div class="join_form">
        <div class="id-container">
          <label for="uid">ì•„ì´ë””</label>
          <input type="text" class="width-450 form-control" name="UserId" id="uid" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
          <input type="button" class="btn btn-success" name="checkId" onclick="check_id()" value="ì•„ì´ë”” ì¤‘ë³µí™•ì¸">
          <span id="idError"></span>
        </div>
        <div class="password-container">
          <label for="pwd">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" class="width-450 form-control" name="memberPassword" id="pwd" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ë¬¸ì, ìˆ«ì í¬í•¨ 8~12ì)">
          <span id="pwdError"></span>
        </div>
          <div>
            <label for="rePwd" >ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input type="password" class="width-450 form-control" name="memberPassword2" id="rePwd" onblur="check_pwd()" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
            <span id="rePwdError"></span>
          </div>
        <div class="name-container">
          <label for="uname" >ì´ë¦„</label>
          <input type="text" class="width-450 form-control" name="memberName" id="uname" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
          <span id="nameError"></span>
        </div>
        <div class="mobile-container">
          <label for="memberMobile" >ì „í™”ë²ˆí˜¸</label>
          <input type="text" class="width-450 form-control" name="memberMobile" id="memberMobile" onblur="check_mobile()" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥ ('-' í¬í•¨ 13ìë¦¬ ì…ë ¥)">
          <span id="mobileError"></span>
        </div>
        <div class="email-container">
          <label for="memberEmail" >ì´ë©”ì¼</label>
          <input type="text" class="width-450 form-control" name="memberEmail" id="memberEmail" onblur="check_email()" placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥ (___@___ í˜•ì‹ìœ¼ë¡œ ì…ë ¥)">
          <input type="button" id="checkEmail" class="btn btn-outline-secondary" value="ì¸ì¦ë²ˆí˜¸ ì „ì†¡" onclick="sendEmail()">
          <span id="emailError"></span>
        </div>
        <div class="mailconfirm-container">
          <label for="mailconfirm" >ì¸ì¦ë²ˆí˜¸</label>
          <input type="text" class="width-450 form-control" name="mailconfirm" id="mailconfirm" placeholder="ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
          <input type="button" id="mailconfirm2" class="btn btn-outline-secondary" value="ì¸ì¦ë²ˆí˜¸ í™•ì¸" onclick="mailConfirm()">
        </div>
      </div>
      <div class="exform_txt"><label>í‘œì‹œëŠ” í•„ìˆ˜ì ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì…”ì•¼ ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</label></div>

      <div class="btn-container">
        <input onclick="joinUs()" type="button" id="joinBtn" class="width-half height-30 form-control form-group group btn-group btn btn-success mt-4" name="join" value="íšŒì›ê°€ì…">
      </div>
    </fieldset>
  </form>
</div>
<input type="hidden" value="" id="mailconfirmCheck">

</body>


<script th:inline="javascript">

  const joinUs = () => {
    const uid = document.getElementById('uid').value;
    const pwd = document.getElementById('pwd').value;
    const rePwd = document.getElementById('rePwd').value;
    const uname = document.getElementById('uname').value;
    const memberMobile = document.getElementById('memberMobile').value;
    const memberEmail = document.getElementById('memberEmail').value;
    const mailconfirm = document.getElementById('mailconfirm').value;
    const mailconfirmCheck = document.getElementById('mailconfirmCheck').value;
    const exp = /^(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/;

    if (uid === '') {
      alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (pwd === '') {
      alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (rePwd === '') {
      alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (rePwd !== pwd) {
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return false;
    }
    if(!document.join.memberPassword.value.match(exp)) {
      const passwordCheck = document.getElementById("pwdError");
      passwordCheck.innerHTML = "ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ ì´ìš©í•˜ì—¬ 8~12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”";
      passwordCheck.style.color = "red";
      return false;
    }
    if (uname === '') {
      alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (memberMobile === '') {
      alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (memberMobile.length !== 13) {
      alert('ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (memberEmail === '') {
      alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (memberEmail.indexOf('@') === -1) {
      alert('ì´ë©”ì¼ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (mailconfirm === '') {
      alert('ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (mailconfirmCheck === '') {
      alert('ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
      return false;
    }
    if (mailconfirm !== mailconfirmCheck) {
      alert('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return false;
    }
    document.join.submit();

  }

  //ì´ë©”ì¼ ì¤‘ë³µì²´í¬, ì´ë©”ì¼ ì¸ì¦
  const sendEmail = () => {
    console.log("ì´ë©”ì¼ ì¤‘ë³µí™•ì¸");
    $.ajax({
      type : "POST",
      url : "/member/mailConfirm",
      data : {
        "email" : document.getElementById("memberEmail").value
      },
      success : function(data){
        if (data == "fail"){
          alert("ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. í™•ì¸í•´ì£¼ì„¸ìš”");
        }else {
          alert("í•´ë‹¹ ì´ë©”ì¼ë¡œ ì¸ì¦ë²ˆí˜¸ ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ğŸ’Œ \n í™•ì¸ë¶€íƒë“œë¦½ë‹ˆë‹¤.")
          document.getElementById("mailconfirmCheck").value = data;
          console.log("data : "+data);
        }

      }
    })
  }


  // ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ì²´í¬ í•¨ìˆ˜
  const mailConfirm = () => {
    const mailconfirmCheck = document.getElementById("mailconfirmCheck").value;
    const mailconfirm = document.getElementById("mailconfirm").value;
    if (mailconfirmCheck == mailconfirm) {
      alert("ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.");
      $("#joinBtn").removeAttr("disabled");
    } else {
      alert("ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      $("#joinBtn").attr("disabled", "disabled");
    }

  }



  //ì•„ì´ë”” ì¤‘ë³µí™•ì¸
  const check_id = () => {
    console.log("í˜¸ì¶œ")
    const id = document.getElementById("uid").value;
    if (id == "") {
      alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    } else {
      $.ajax({
        type: "post",
        url: "/member/checkUserId",
        data: {
          userId: id
        },
        dataType: "text",
        success: function (loginResult) {
          console.log("ì„±ê³µ");
          console.log(loginResult);
          if (loginResult == "success") {
            $("#joinBtn").removeAttr("disabled");
            alert("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.")

          } else {
            $("#joinBtn").attr("disabled", "disabled");
            alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.")
          }
        },
        error: function () {
          console.log("ì‹¤íŒ¨")
        }
      })
    }
  }

  //ì •ê·œì‹ ì²´í¬
  const check_pwd = () => {
    const pwd = document.getElementById('pwd').value;
    const rePwd = document.getElementById('rePwd').value;
    const exp = /^(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/;

    if(!document.join.memberPassword.value.match(exp)){
      $("#joinBtn").attr("disabled", "disabled");
      const passwordCheck =document.getElementById("pwdError");
      passwordCheck.innerHTML="ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ ì´ìš©í•˜ì—¬ 8~12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”";
      passwordCheck.style.color="red";
    } else if(pwd === rePwd){
      $("#joinBtn").removeAttr("disabled");
      document.getElementById("pwdError").innerHTML = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
      document.getElementById("pwdError").style.color = "blue";
    }
  }

  const check_mobile = () => {
    const mobile = document.getElementById("memberMobile").value;
    const mobileCheck = document.getElementById("mobileError");
    const regExp = /^\d{3}-\d{3,4}-\d{4}$/;
    if (!regExp.test(mobile)) {
      $("#joinBtn").attr("disabled", "disabled");
      document.getElementById("memberMobile").value = "";
      mobileCheck.innerHTML = "ì „í™”ë²ˆí˜¸ëŠ” 000-0000-0000 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”."
      mobileCheck.style.color = "red"
    } else {
      $("#joinBtn").removeAttr("disabled");
      mobileCheck.innerHTML = ""
    }
  }

  const check_email = () => {
    const email = document.getElementById("memberEmail").value;
    const emailCheck = document.getElementById("emailError");
    const regExp = /\w+([-+.]\w+)*@\w+([-.]\w+)*\.[a-zA-Z]{2,4}$/;
    if (!regExp.test(email)) {
      $("#joinBtn").attr("disabled", "disabled");
      document.getElementById("memberEmail").value = "";
      emailCheck.innerHTML = "ì´ë©”ì¼ì€ ____@____ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      emailCheck.style.color = "red";
    } else {
      $("#joinBtn").removeAttr("disabled");
      emailCheck.innerHTML = ""
    }
  }
  // const check_name = () => {
  //   console.log("check_name í•¨ìˆ˜í˜¸ì¶œ");
  //   if(document.join.memberName.value === ""){
  //     $("#joinBtn").attr("disabled", "disabled");
  //     const nameCheck = document.getElementById("nameError");
  //     nameCheck.innerHTML="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
  //     nameCheck.style.color="red";
  //     return false;
  //   } else{
  //     $("#joinBtn").removeAttr("disabled");
  //     const nameCheck = document.getElementById("nameError");
  //     nameCheck.innerHTML="";
  //   }
  // }
</script>
</html>