<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ğŸˆFind your Base:)-íšŒì›ì •ë³´ìˆ˜ì •</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!--ajax cdn-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!--  í°íŠ¸-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <style>
        *{
            font-family: 'Jua', sans-serif;
            font-family: 'Nanum Gothic', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
        }
        #update-form {
            width: 400px;
            height: 409px;
            left: 411px;
            top: 85px;
            /*ê°€ìš´ë° ì •ë ¬ margin: auto*/
            margin-top: 100px;
            margin-left: auto;
            margin-right: auto;
        }

        label{
            margin-top: 20px;
        }
    </style>
</head>
<body style="background-color: white">
<th:block th:replace="commonPages/header :: header"></th:block>
<div class="container" id="update-form">
    <form action="/member/update" method="post" name="updateCheck">
        <input type="hidden" name="id" th:value="${session.member.id}">

        <label>ì•„ì´ë””</label>
        <input type="text" name="userId" th:value="${session.member.userId}" class="form-control" readonly>
        <div>
            <label for="pwdUpdate">ë³€ê²½ ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" name="memberPassword" id="pwdUpdate" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ë¬¸ì, ìˆ«ì í¬í•¨ 8~12ì)">
            <span id="pwdUpdateError"></span>
        </div>
        <div>
            <label for="rePwdUpdate">ë³€ê²½ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input type="password" name="memberPassword2" id="rePwdUpdate" onblur="updateCheck_pwd()" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
            <span id="reUpdatePwdError"></span>
        </div>
        <div>
            <label for="memberName" >ì´ë¦„</label>
            <input type="text" name="memberName" id="memberName" th:value="${session.member.memberName}" class="form-control">
            <span id="nameUpdateError"></span>
        </div>
        <div>
            <label for="memberMobile">ì „í™”ë²ˆí˜¸</label>
            <input type="text" name="memberMobile" id="memberMobile" th:value="${session.member.memberMobile}" onblur="updateCheck_mobile()" class="form-control">
            <span id="mobileUpdateError"></span>
        </div>
        <div>
            <label for="memberEmail">ì´ë©”ì¼</label>
            <input type="text" name="memberEmail" id="memberEmail" th:value="${session.member.memberEmail}" class="form-control" readonly>
            <span id="emailUpdateError"></span>
        </div>
        <input type="button" id="updateBtn" class="btn btn-success" name="updateCheck" onclick="updateUs()" style="width: 385px; margin-top: 20px; text-align: center" value="ì •ë³´ìˆ˜ì •">
    </form>
</div>

</body>
<script th:inline="javascript">
    const updateUs = () => {
        const pwdUpdate = document.getElementById('pwdUpdate').value;
        const rePwdUpdate = document.getElementById('rePwdUpdate').value;
        const memberName = document.getElementById('memberName').value;
        const memberMobile = document.getElementById('memberMobile').value;
        const memberEmail = document.getElementById('memberEmail').value;
        const exp = /^(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/;


        if (pwdUpdate === '') {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return false;
        }
        if (rePwdUpdate === '') {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
            return false;
        }
        if (rePwdUpdate !== pwdUpdate) {
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            return false;
        }
        if(!document.updateCheck.memberPassword.value.match(exp)) {
            const passwordCheck = document.getElementById("pwdUpdateError");
            passwordCheck.innerHTML = "ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ ì´ìš©í•˜ì—¬ 8~12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”";
            passwordCheck.style.color = "red";
            return false;
        }
        if (memberName === '') {
            alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return false;
        }
        if (memberMobile === '') {
            alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return false;
        }
        if (memberMobile.length !== 13) {
            alert('ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return false;
        }
        document.updateCheck.submit();
    }

    const updateCheck_pwd = () => {
        const pwdUpdate = document.getElementById('pwdUpdate').value;
        const rePwdUpdate = document.getElementById('rePwdUpdate').value;
        const exp = /^(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/;
        if(!document.updateCheck.memberPassword.value.match(exp)){
            $("#updateBtn").attr("disabled", "disabled");
            const passwordCheck2 =document.getElementById("pwdUpdateError");
            passwordCheck2.innerHTML="ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ ì´ìš©í•˜ì—¬ 8~12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”";
            passwordCheck2.style.color="red";
        } else if(pwdUpdate === rePwdUpdate) {
            $("#updateBtn").removeAttr("disabled");
            document.getElementById("pwdUpdateError").innerHTML = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
            document.getElementById("pwdUpdateError").style.color = "blue";
        }
    }
    const updateCheck_mobile = () => {
        const mobile = document.getElementById("memberMobile").value;
        const mobileCheck = document.getElementById("mobileUpdateError");
        const regExp = /^\d{3}-\d{3,4}-\d{4}$/;
        if (!regExp.test(mobile)) {
            $("#updateBtn").attr("disabled", "disabled");
            document.getElementById("memberMobile").value = "";
            mobileCheck.innerHTML = "ì „í™”ë²ˆí˜¸ëŠ” 000-0000-0000 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”."
            mobileCheck.style.color = "red"
        } else {
            $("#updateBtn").removeAttr("disabled");
            mobileCheck.innerHTML = ""
        }
    }
    // const update = () => {
    //  document.updateForm.submit();
    // }

</script>
</html>